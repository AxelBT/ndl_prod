<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>NIRD – Résistance Numérique</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Police retro gaming -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&family=VT323&display=swap" rel="stylesheet">
    
    <!-- Styles personnalisés rétro gaming -->
    <style>
        :root {
            --retro-green: #00ff41;
            --retro-pink: #ff00ff;
            --retro-blue: #00b3ff;
            --retro-yellow: #ffff00;
            --retro-bg: #0a0a12;
            --retro-grid: #1a1a2e;
            --crt-flicker: rgba(0, 255, 65, 0.1);
        }
        
        body {
            background-color: var(--retro-bg);
            font-family: 'VT323', 'Courier New', monospace;
            color: var(--retro-green);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            margin: 0;
        }
        
        /* Effet CRT (écran cathodique) */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 0, 0, 0.15),
                    rgba(0, 0, 0, 0.15) 1px,
                    transparent 1px,
                    transparent 2px
                );
            pointer-events: none;
            z-index: 9999;
            animation: flicker 0.15s infinite;
        }
        
        /* Effet de scanlines */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 0, 0, 0.2) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9998;
            animation: scanlines 10s linear infinite;
        }
        
        /* Animation CRT */
        @keyframes flicker {
            0% { opacity: 0.97; }
            5% { opacity: 0.99; }
            10% { opacity: 0.97; }
            15% { opacity: 1; }
            20% { opacity: 0.98; }
            50% { opacity: 1; }
            100% { opacity: 0.97; }
        }
        
        @keyframes scanlines {
            from { background-position: 0 0; }
            to { background-position: 0 100vh; }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        
        @keyframes pixelate {
            0% { filter: blur(0px); }
            50% { filter: blur(1px); }
            100% { filter: blur(0px); }
        }
        
        /* Style retro gaming */
        .retro-title {
            font-family: 'Press Start 2P', cursive;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 
                0 0 10px var(--retro-green),
                0 0 20px var(--retro-green),
                0 0 30px var(--retro-green);
            animation: blink 2s infinite, glitch 5s infinite;
            position: relative;
        }
        
        .retro-title::before, .retro-title::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .retro-title::before {
            animation: glitch 3s infinite;
            color: var(--retro-pink);
            z-index: -1;
        }
        
        .retro-title::after {
            animation: glitch 2s infinite reverse;
            color: var(--retro-blue);
            z-index: -2;
        }
        
        .retro-border {
            border: 4px solid var(--retro-green);
            border-image: 
                repeating-linear-gradient(
                    45deg,
                    var(--retro-green),
                    var(--retro-green) 10px,
                    var(--retro-bg) 10px,
                    var(--retro-bg) 20px
                ) 4;
            box-shadow: 
                0 0 20px var(--retro-green),
                inset 0 0 20px var(--retro-green);
            position: relative;
            background: rgba(10, 10, 18, 0.9);
        }
        
        .retro-border::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 2px solid var(--retro-pink);
            z-index: -1;
            opacity: 0.5;
        }
        
        .retro-button {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            letter-spacing: 3px;
            text-transform: uppercase;
            border: none;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            text-shadow: 0 0 5px currentColor;
            animation: pixelate 4s infinite;
        }
        
        .retro-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.4),
                transparent
            );
            transition: left 0.7s;
        }
        
        .retro-button:hover::before {
            left: 100%;
        }
        
        .retro-button:hover {
            transform: scale(1.05);
            animation: glitch 0.3s;
        }
        
        .red-pill {
            background: linear-gradient(45deg, #ff0033, #cc0029);
            color: white;
            box-shadow: 
                0 0 20px #ff0033,
                0 0 40px #ff0033,
                inset 0 0 20px rgba(255, 255, 255, 0.2);
        }
        
        .red-pill:hover {
            box-shadow: 
                0 0 30px #ff3366,
                0 0 50px #ff3366,
                inset 0 0 20px rgba(255, 255, 255, 0.4);
        }
        
        .blue-pill {
            background: linear-gradient(45deg, #0066ff, #0052cc);
            color: white;
            box-shadow: 
                0 0 20px #0066ff,
                0 0 40px #0066ff,
                inset 0 0 20px rgba(255, 255, 255, 0.2);
        }
        
        .blue-pill:hover {
            box-shadow: 
                0 0 30px #3399ff,
                0 0 50px #3399ff,
                inset 0 0 20px rgba(255, 255, 255, 0.4);
        }
        
        /* Terminal effect */
        .terminal-text {
            font-family: 'VT323', monospace;
            font-size: 1.4rem;
            line-height: 1.6;
            border-right: 3px solid var(--retro-green);
            white-space: nowrap;
            overflow: hidden;
            animation: 
                typing 4s steps(40, end),
                blink-caret 0.75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--retro-green) }
        }
        
        /* Pixel art decoration */
        .pixel-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(
                    circle at 20% 30%, 
                    transparent 20%, 
                    rgba(0, 255, 65, 0.05) 21%, 
                    transparent 22%
                ),
                radial-gradient(
                    circle at 80% 70%, 
                    transparent 20%, 
                    rgba(255, 0, 255, 0.05) 21%, 
                    transparent 22%
                );
            pointer-events: none;
            z-index: -1;
        }
        
        /* Matrix rain effect retro - NOUVEAU STYLE */
        .matrix-visualizer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            opacity: 0.4;
            filter: blur(0.5px);
            pointer-events: none;
        }
        
        /* Contrôles du visualiseur */
        .visualizer-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            display: flex;
            gap: 10px;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            border: 2px solid var(--retro-green);
            border-radius: 5px;
            backdrop-filter: blur(5px);
        }
        
        .visualizer-controls button, .visualizer-controls input[type="file"] {
            color: var(--retro-green);
            background: #000;
            border: 1px solid var(--retro-green);
            padding: 8px 12px;
            margin: 0;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .visualizer-controls button:hover, .visualizer-controls input[type="file"]:hover {
            background: rgba(0, 255, 65, 0.2);
            box-shadow: 0 0 10px var(--retro-green);
        }
        
        .visualizer-controls input[type="file"] {
            max-width: 200px;
        }
        
        /* 8-bit animation for stats */
        .bit-counter {
            font-family: 'Press Start 2P', cursive;
            color: var(--retro-yellow);
            text-shadow: 0 0 10px var(--retro-yellow);
            animation: blink 1s infinite;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .retro-title {
                font-size: 1.8rem !important;
            }
            
            .terminal-text {
                font-size: 1.1rem;
                white-space: normal;
                border-right: none;
                animation: none;
            }
            
            .choices-container {
                flex-direction: column;
                gap: 20px !important;
            }
            
            .visualizer-controls {
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
                bottom: 10px;
            }
            
            .visualizer-controls button, .visualizer-controls input[type="file"] {
                padding: 6px 10px;
                font-size: 0.9rem;
            }
        }
        
        /* Loading screen effect */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--retro-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeOut 1s ease-in-out 3s forwards;
        }
        
        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }
        
        .loading-text {
            font-family: 'Press Start 2P', cursive;
            color: var(--retro-green);
            font-size: 1.2rem;
            animation: blink 0.5s infinite;
        }
    </style>
</head>
<body class="p-4 md:p-0">
    
    <!-- Loading screen retro -->
    <div class="loading-screen">
        <div class="text-center">
            <div class="loading-text mb-4">SYSTEM BOOT</div>
            <div class="inline-block w-64 h-2 bg-gray-800 overflow-hidden">
                <div class="h-full bg-green-500 animate-pulse" style="width: 0%; animation: load 3s ease-in-out forwards;"></div>
            </div>
            <div class="loading-text mt-4">LOADING N.I.R.D OS</div>
        </div>
    </div>
    
    <!-- NOUVEAU VISUALISEUR MATRIX DANCING -->
    <canvas class="matrix-visualizer" id="matrixCanvas"></canvas>
    
    <!-- Pixel grid decoration -->
    <div class="pixel-grid"></div>
    
    <!-- Contrôles du visualiseur -->
    <div class="visualizer-controls">
        <input type="file" id="audioFile" accept="audio/*" class="retro-button">
        <button id="playBtn" class="retro-button">Play</button>
        <button id="pauseBtn" class="retro-button">Pause</button>
        <button id="stopBtn" class="retro-button">Stop</button>
        <button id="toggleBtn" class="retro-button">Hide Controls</button>
    </div>
    
    <!-- Contenu principal -->
    <div class="container mx-auto px-4 py-8 md:py-16 max-w-6xl relative">
        
        <!-- En-tête avec effet ASCII Art -->
        <header class="text-center mb-12">
            <div class="mb-8">
                <div class="inline-block px-4 py-2 retro-border mb-6">
                    <span class="text-green-400 font-bold text-lg tracking-widest">[ N.I.R.D OS v2.0 ]</span>
                </div>
                
                <!-- ASCII Art Title -->
                <div class="mb-8 text-left max-w-md mx-auto text-xs md:text-sm opacity-70">
                   <h1 class="text-green-400 text-5xl md:text-7xl font-bold mb-6 animate-pulse" style="font-family: 'Press Start 2P', cursive;">
    N.I.R.D
</h1>
                </div>
                
                <h1 class="retro-title text-4xl md:text-6xl mb-6" data-text="RÉSISTANCE NUMÉRIQUE">
                    RÉSISTANCE NUMÉRIQUE
                </h1>
                
                <div class="text-pink-500 font-mono text-sm md:text-base mb-4 animate-pulse">
                    [ NUMERIQUE INCLUSIF RESPONSABLE ]
                </div>
            </div>
        </header>
        
        <!-- Section principale avec effet terminal -->
        <main class="retro-border p-6 md:p-10 mb-12 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-green-500 to-pink-500"></div>
            
            <div class="terminal-text mb-8 text-green-300">
                <span class="text-yellow-400">user@nird:~$</span> system_analysis --init
            </div>
            
            <div class="space-y-6 text-lg md:text-xl">
                <p class="text-cyan-300">
                    <span class="text-yellow-400">></span> À l'ère où la fin du support de 
                    <span class="text-red-400 font-bold">Windows 10</span> nous rappelle notre dépendance technologique...
                </p>
                
                <p class="text-green-300">
                    <span class="text-yellow-400">></span> Un système alternatif s'initialise : 
                    <span class="text-green-400 font-bold">NUMÉRIQUE INCLUSIF, RESPONSABLE, DURABLE</span>
                </p>
                
                <div class="p-4 bg-black/50 border-l-4 border-green-500 my-6">
                    <p class="text-white italic">
                        <span class="text-yellow-400">#</span> "Un autre OS est possible. Un autre futur est exécutable."
                    </p>
                </div>
                
                <p class="text-cyan-300">
                    <span class="text-yellow-400">></span> Le terminal vous attend. Quelle commande allez-vous exécuter ?
                </p>
            </div>
            
            <!-- Stats en 8-bit -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-10 pt-8 border-t border-green-900">
                <div class="text-center">
                    <div class="bit-counter text-2xl md:text-3xl">150K+</div>
                    <div class="text-green-400 text-sm">RESISTANTS</div>
                </div>
                <div class="text-center">
                    <div class="bit-counter text-2xl md:text-3xl">24/7</div>
                    <div class="text-green-400 text-sm">SYSTEM ONLINE</div>
                </div>
                <div class="text-center">
                    <div class="bit-counter text-2xl md:text-3xl">100%</div>
                    <div class="text-green-400 text-sm">OPEN SOURCE</div>
                </div>
                <div class="text-center">
                    <div class="bit-counter text-2xl md:text-3xl">∞</div>
                    <div class="text-green-400 text-sm">POSSIBILITIES</div>
                </div>
            </div>
        </main>
        
        <!-- Choix avec effet retro gaming -->
        <section class="mb-16">
            <div class="text-center mb-10">
                <div class="inline-block px-6 py-3 retro-border mb-4">
                    <h2 class="text-2xl md:text-3xl font-bold text-green-400 tracking-widest">
                        [ CHOOSE YOUR PATH ]
                    </h2>
                </div>
                <p class="text-green-300 text-lg animate-pulse">
                    Appuyez sur START pour continuer
                </p>
            </div>
            
            <div class="choices-container flex flex-col md:flex-row justify-center items-center gap-8 md:gap-12">
                <!-- Pilule Rouge - Style Arcade -->
                <a href="/choose-role" class="group relative w-full md:w-1/2 max-w-md">
                    <div class="absolute -inset-4 bg-gradient-to-r from-red-900/30 to-transparent rounded-3xl blur-lg group-hover:blur-xl transition-all duration-500"></div>
                    
                    <div class="relative retro-border p-2 h-full">
                        <div class="bg-black/90 p-8 h-full">
                            <div class="flex items-center justify-between mb-6">
                                <div class="text-red-400 font-bold text-xl tracking-widest">[ P1 ]</div>
                                <div class="text-yellow-400 animate-pulse">PLAYER 1 READY</div>
                            </div>
                            
                            <div class="text-center mb-8">
                                <div class="inline-block px-6 py-3 bg-red-900/50 border-2 border-red-700 mb-4">
                                    <h3 class="retro-button text-2xl md:text-3xl text-white" style="font-family: 'Orbitron', sans-serif;">
                                        PILULE ROUGE
                                    </h3>
                                </div>
                                <p class="text-gray-300 text-lg mb-6">
                                    <span class="text-red-400">>></span> ACCÉDER AU CODE SOURCE
                                </p>
                                <p class="text-white">
                                    Rejoignez la résistance, découvrez la vérité sur le système,<br>
                                    reprenez le contrôle de vos données.
                                </p>
                            </div>
                            
                            <button class="retro-button red-pill w-full py-5 text-xl font-bold rounded-none">
                                [ REJOINDRE LA RESISTANCE ]
                            </button>
                            
                            <div class="mt-6 text-center text-gray-500 text-sm">
                                <span class="text-green-400">▲</span> RECOMMANDÉ <span class="text-green-400">▲</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- Séparateur retro -->
                <div class="my-8 md:my-0">
                    <div class="retro-border p-4">
                        <div class="text-center text-yellow-400 text-2xl font-bold rotate-0 ">
                            <span class="animate-pulse">VS</span>
                        </div>
                    </div>
                </div>
                
                <!-- Pilule Bleue - Style Arcade -->
                <a href="https://www.microsoft.com/windows" target="_blank" class="group relative w-full md:w-1/2 max-w-md">
                    <div class="absolute -inset-4 bg-gradient-to-l from-blue-900/30 to-transparent rounded-3xl blur-lg group-hover:blur-xl transition-all duration-500"></div>
                    
                    <div class="relative retro-border p-2 h-full opacity-90 hover:opacity-100 transition-opacity">
                        <div class="bg-black/90 p-8 h-full">
                            <div class="flex items-center justify-between mb-6">
                                <div class="text-blue-400 font-bold text-xl tracking-widest">[ P2 ]</div>
                                <div class="text-gray-500">PLAYER 2</div>
                            </div>
                            
                            <div class="text-center mb-8">
                                <div class="inline-block px-6 py-3 bg-blue-900/50 border-2 border-blue-700 mb-4">
                                    <h3 class="retro-button text-2xl md:text-3xl text-white" style="font-family: 'Orbitron', sans-serif;">
                                        PILULE BLEUE
                                    </h3>
                                </div>
                                <p class="text-gray-300 text-lg mb-6">
                                    <span class="text-blue-400">>></span> RESTER EN MODE STANDARD
                                </p>
                                <p class="text-white">
                                    Continuez comme avant, acceptez les mises à jour imposées,<br>
                                    restez dans la matrice.
                                </p>
                            </div>
                            
                            <button class="retro-button blue-pill w-full py-5 text-xl font-bold rounded-none">
                                [ STATUS_QUO ]
                            </button>
                            
                            <div class="mt-6 text-center text-gray-500 text-sm">
                                <span class="text-red-400">▼</span> DÉCONSEILLÉ <span class="text-red-400">▼</span>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </section>
        
        <!-- Footer retro -->
        <footer class="text-center pt-8 border-t border-green-900">
            <div class="mb-6">
                <div class="inline-flex space-x-6">
                    <button class="text-green-400 hover:text-yellow-400 transition-colors" onclick="window.location.reload()">
                        [ RELOAD SYSTEM ]
                    </button>
                    <button class="text-green-400 hover:text-yellow-400 transition-colors" onclick="showCredits()">
                        [ VIEW CREDITS ]
                    </button>
                    <button class="text-green-400 hover:text-yellow-400 transition-colors" onclick="toggleVisualizer()" id="visToggleBtn">
                        [ VISUALIZER: ON ]
                    </button>
                </div>
            </div>
            
            <div class="text-gray-600 text-sm font-mono">
                N.I.R.D OS v2.0 © 2024 - RESISTANCE NUMERIQUE - ALL SYSTEMS OPERATIONAL
            </div>
            
            <!-- Easter Egg -->
            <div class="mt-8 opacity-10 hover:opacity-100 transition-opacity duration-1000">
                <div class="text-xs text-center">
                    <span class="cursor-pointer" onclick="easterEgg()">↑ ↑ ↓ ↓ ← → ← → B A START</span>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Scripts rétro gaming avec visualiseur Matrix dancing -->
    <script>
        // ==================== VISUALISEUR MATRIX DANCING ====================
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const fontSize = 18;
        let columns = Math.floor(canvas.width / fontSize);
        let drops = [];
        let waveOffsets = [];

        // Caractères Matrix avec des symboles rétro gaming
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()*&^%<>[]{}|\\/~`+=_-?!:;"\',.';



        function initDrops() {
            drops = Array(columns).fill(1);
            waveOffsets = Array.from({length: columns}, (_, i) => Math.random() * Math.PI * 2);
        }
        initDrops();

        let audioCtx, analyser, source;
        let animationId;
        let currentAudio = null;
        let isPaused = false;
        let visualizerEnabled = true;

        // Éléments de contrôle
        const audioFileInput = document.getElementById('audioFile');
        const defaultSongs = [
    'matrix.mp3', // remplace par tes fichiers
    'godfrey.mp3'
];
let currentSongIndex = 0;
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const toggleBtn = document.getElementById('toggleBtn');
        const visToggleBtn = document.getElementById('visToggleBtn');

        // Charger un fichier audio
        audioFileInput.onchange = function() {
            const file = this.files[0];
            if(!file) return;

            if(animationId) cancelAnimationFrame(animationId);
            if(currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }

            // Effacer le canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            initDrops();

            const audio = new Audio(URL.createObjectURL(file));
            audio.play();
            currentAudio = audio;
            isPaused = false;

            // Initialiser l'audio context
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                analyser.fftSize = 256;

                source = audioCtx.createMediaElementSource(audio);
                source.connect(analyser);
                source.connect(audioCtx.destination);

                // Démarrer l'animation
                animate();
            } catch(e) {
                console.error("Erreur AudioContext:", e);
                // Mode démo sans audio
                animateDemo();
            }
        }

        // Contrôles de lecture
        playBtn.onclick = function() {
            if(currentAudio && isPaused) {
                currentAudio.play();
                isPaused = false;
                animate();
            } else if(!currentAudio) {
                // Si aucun audio n'est chargé, démarrer le mode démo
                animateDemo();
            }
        }

        pauseBtn.onclick = function() {
            if(currentAudio && !isPaused) {
                currentAudio.pause();
                isPaused = true;
                if(animationId) cancelAnimationFrame(animationId);
            }
        }

        stopBtn.onclick = function() {
            if(currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
                isPaused = false;
            }
            if(animationId) cancelAnimationFrame(animationId);

            // Effacer le canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            initDrops();
        }

        // Basculer l'affichage des contrôles
        toggleBtn.onclick = function() {
            const controls = document.querySelector('.visualizer-controls');
            if(controls.style.display === 'none') {
                controls.style.display = 'flex';
                toggleBtn.textContent = 'Hide Controls';
            } else {
                controls.style.display = 'none';
                toggleBtn.textContent = 'Show Controls';
            }
        }

        // Fonction d'animation avec analyse audio
        function animate() {
            if(isPaused) return;

            animationId = requestAnimationFrame(animate);
            if(!analyser) return;

            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);

            // Fond avec effet de traînée
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Police rétro gaming
            ctx.font = `${fontSize}px 'VT323', monospace`;

            for(let i = 0; i < drops.length; i++) {
                const freqValue = dataArray[i % bufferLength];
                const brightness = Math.min(1, freqValue / 200);

                let x = i * fontSize;
                let y = drops[i] * fontSize;

                // Effet de vague dansante horizontal
                const wave = Math.sin(Date.now() * 0.002 + waveOffsets[i]) * 10;
                x += wave; // mouvement horizontal

                const char = letters[Math.floor(Math.random() * letters.length)];

                // Couleurs dégradées rétro gaming
                if(drops[i] <= 1) {
                    ctx.fillStyle = "rgba(255, 255, 200, 1)"; // Blanc chaud
                } else if(drops[i] <= 3) {
                    ctx.fillStyle = "rgba(180, 255, 180, 0.9)"; // Vert clair
                } else {
                    const fadeFactor = Math.max(0.2, 1 - drops[i] * 0.0015);
                    // Alterner entre vert, rose et bleu pour l'effet rétro
                    const colorIndex = Math.floor(Date.now() / 1000 + i) % 3;
                    if(colorIndex === 0) {
                        ctx.fillStyle = `rgba(0, 255, 65, ${fadeFactor})`; // Vert néon
                    } else if(colorIndex === 1) {
                        ctx.fillStyle = `rgba(0, 255, 65, ${fadeFactor})`; // Rose néon
                    } else {
                        ctx.fillStyle = `rgba(0, 255, 65, ${fadeFactor})`; // Bleu néon
                    }
                }

                ctx.fillText(char, x, y);

                // Ajouter un mouvement vertical dansant
                const wobble = Math.sin(Date.now() * 0.004 + i) * 0.3;
                drops[i] += (1 + brightness * 15) * 0.13 + wobble;

                if (drops[i] * fontSize > canvas.height) {
                    drops[i] = 1;
                    // Réinitialiser l'offset de vague pour une nouvelle colonne
                    waveOffsets[i] = Math.random() * Math.PI * 2;
                }
            }
        }

        // Mode démo (sans fichier audio)
        function animateDemo() {
            if(!visualizerEnabled) return;
            
            animationId = requestAnimationFrame(animateDemo);

            // Générer des données de fréquence simulées
            const bufferLength = 128;
            const dataArray = new Uint8Array(bufferLength);
            const time = Date.now() * 0.001;
            
            for(let i = 0; i < bufferLength; i++) {
                // Créer un pattern intéressant de fréquences
                const baseFreq = Math.sin(time * 0.5 + i * 0.1) * 50 + 100;
                const pulse = Math.sin(time * 2 + i * 0.05) * 30;
                const noise = Math.random() * 20;
                dataArray[i] = Math.min(255, Math.max(0, baseFreq + pulse + noise));
            }

            // Fond avec effet de traînée
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Police rétro gaming
            ctx.font = `${fontSize}px 'VT323', monospace`;

            for(let i = 0; i < drops.length; i++) {
                const freqValue = dataArray[i % bufferLength];
                const brightness = Math.min(1, freqValue / 200);

                let x = i * fontSize;
                let y = drops[i] * fontSize;

                // Effet de vague dansante horizontal
                const wave = Math.sin(time * 2 + waveOffsets[i]) * 12;
                x += wave;

                const char = letters[Math.floor(Math.random() * letters.length)];

                // Couleurs dégradées rétro gaming
                if(drops[i] <= 1) {
                    ctx.fillStyle = "rgba(255, 255, 200, 1)";
                } else if(drops[i] <= 3) {
                    ctx.fillStyle = "rgba(180, 255, 180, 0.9)";
                } else {
                    const fadeFactor = Math.max(0.2, 1 - drops[i] * 0.0015);
                    // Alterner les couleurs pour l'effet rétro
                    const colorIndex = Math.floor(time + i * 0.01) % 3;
                    if(colorIndex === 0) {
                        ctx.fillStyle = `rgba(0, 255, 65, ${fadeFactor})`;
                    } else if(colorIndex === 1) {
                        ctx.fillStyle = `rgba(0, 255, 65, ${fadeFactor})`;
                    } else {
                        ctx.fillStyle = `rgba(0, 255, 65, ${fadeFactor})`;
                    }
                }

                ctx.fillText(char, x, y);

                // Ajouter un mouvement vertical dansant
                const wobble = Math.sin(time * 4 + i) * 0.4;
                drops[i] += (1 + brightness * 15) * 0.15 + wobble;

                if (drops[i] * fontSize > canvas.height) {
                    drops[i] = 1;
                    waveOffsets[i] = Math.random() * Math.PI * 2;
                }
            }
        }

        // Redimensionnement
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            columns = Math.floor(canvas.width / fontSize);
            initDrops();
        });

        // Démarrer le mode démo au chargement
        setTimeout(() => {
            if(visualizerEnabled) {
                animateDemo();
            }
        }, 3500);

        // ==================== FONCTIONS EXISTANTES ====================
        
        // Animation loading
        document.querySelector('.loading-screen .bg-green-500').addEventListener('animationend', function() {
            this.style.width = '100%';
        });

        // Toggle visualizer
        function toggleVisualizer() {
            visualizerEnabled = !visualizerEnabled;
            
            if(visualizerEnabled) {
                canvas.style.opacity = '0.4';
                visToggleBtn.textContent = '[ VISUALIZER: ON ]';
                if(!animationId) {
                    animateDemo();
                }
            } else {
                canvas.style.opacity = '0';
                visToggleBtn.textContent = '[ VISUALIZER: OFF ]';
                if(animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                    // Effacer le canvas
                    ctx.fillStyle = '#000';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
            }
        }

        // Easter egg
        function easterEgg() {
            const title = document.querySelector('.retro-title');
            title.style.animation = 'glitch 0.5s infinite';
            
            // Effet spécial sur le visualiseur
            if(visualizerEnabled) {
                // Changer temporairement les caractères
                const originalLetters = letters;
                // Caractères spéciaux pour l'easter egg
                const easterChars = 'MATRIXHACKED1234567890!@#$%^&*';
                
                // Modifier temporairement la fonte
                ctx.font = `${fontSize}px "Press Start 2P", monospace`;
                
                // Effet de surbrillance
                canvas.style.filter = 'blur(0px) brightness(2)';
                
                setTimeout(() => {
                    title.style.animation = '';
                    canvas.style.filter = 'blur(0.5px) brightness(1)';
                    ctx.font = `${fontSize}px 'VT323', monospace`;
                }, 3000);
            }
            
            // Message secret
            const secret = document.createElement('div');
            secret.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 retro-border p-8 bg-black z-50';
            secret.innerHTML = `
                <div class="text-center">
                    <div class="text-green-400 text-2xl mb-4">EASTER EGG ACTIVATED!</div>
                    <div class="text-white mb-6">MATRIX VISUALIZER: MAXIMUM INTENSITY</div>
                    <div class="text-yellow-400 text-sm mb-4">Try uploading your own audio file!</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="retro-button px-6 py-3 bg-red-500">
                        [ CLOSE ]
                    </button>
                </div>
            `;
            document.body.appendChild(secret);
        }

        // Credits
        function showCredits() {
            const credits = document.createElement('div');
            credits.className = 'fixed top-0 left-0 w-full h-full bg-black/90 flex items-center justify-center z-50';
            credits.innerHTML = `
                <div class="retro-border p-8 max-w-2xl w-full mx-4">
                    <div class="text-center mb-8">
                        <h3 class="text-green-400 text-3xl mb-4">N.I.R.D OS CREDITS</h3>
                        <div class="space-y-4 text-left text-white">
                            <div class="flex justify-between">
                                <span>SYSTEM DESIGN:</span>
                                <span class="text-green-400">NIRD TEAM</span>
                            </div>
                            <div class="flex justify-between">
                                <span>MATRIX VISUALIZER:</span>
                                <span class="text-green-400">DANCING EFFECT v2.0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>AUDIO PROCESSING:</span>
                                <span class="text-green-400">Web Audio API</span>
                            </div>
                            <div class="flex justify-between">
                                <span>RETRO ENGINE:</span>
                                <span class="text-green-400">80s/90s TECH</span>
                            </div>
                            <div class="flex justify-between">
                                <span>RESISTANCE LEADER:</span>
                                <span class="text-green-400">NEO [CLASSIFIED]</span>
                            </div>
                            <div class="flex justify-between">
                                <span>SPECIAL THANKS:</span>
                                <span class="text-green-400">THE FREE SOFTWARE COMMUNITY</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-center">
                        <button onclick="this.parentElement.parentElement.remove()" class="retro-button px-6 py-3 bg-green-500">
                            [ RETURN TO SYSTEM ]
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(credits);
        }

        // Animation de la barre de chargement
        const loadBar = document.querySelector('.loading-screen .bg-green-500');
        loadBar.style.animation = 'load 3s ease-in-out forwards';

        // Définir l'animation de chargement
        const style = document.createElement('style');
        style.textContent = `
            @keyframes load {
                0% { width: 0%; }
                100% { width: 100%; }
            }
        `;
        document.head.appendChild(style);

        // Effet de frappe au clavier
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const redPill = document.querySelector('.red-pill');
                redPill.style.animation = 'glitch 0.3s';
                setTimeout(() => {
                    redPill.style.animation = '';
                }, 300);
                
                // Faire réagir le visualiseur
                if(visualizerEnabled && drops.length > 0) {
                    for(let i = 0; i < 10; i++) {
                        const randomIndex = Math.floor(Math.random() * drops.length);
                        drops[randomIndex] = 1;
                    }
                }
            }
            
            // Touche espace pour basculer le visualiseur
            if (e.key === ' ') {
                e.preventDefault();
                toggleVisualizer();
            }
        });

        // Faire réagir le visualiseur aux mouvements de souris
        document.addEventListener('mousemove', function(e) {
            if(visualizerEnabled && drops.length > 0) {
                const xPercent = e.clientX / window.innerWidth;
                const columnIndex = Math.floor(xPercent * columns);
                
                if(columnIndex >= 0 && columnIndex < drops.length) {
                    // Ajouter un peu de mouvement à la colonne survolée
                    waveOffsets[columnIndex] += 0.1;
                }
            }
        });

        // Faire réagir le visualiseur aux clics
        document.addEventListener('click', function(e) {
            if(visualizerEnabled && drops.length > 0) {
                const xPercent = e.clientX / window.innerWidth;
                const columnIndex = Math.floor(xPercent * columns);
                
                if(columnIndex >= 0 && columnIndex < drops.length) {
                    // Réinitialiser la colonne cliquée
                    drops[columnIndex] = 1;
                    waveOffsets[columnIndex] = Math.random() * Math.PI * 2;
                    
                    // Effet visuel de vague
                    for(let i = Math.max(0, columnIndex - 5); i < Math.min(columns, columnIndex + 5); i++) {
                        const distance = Math.abs(i - columnIndex);
                        const delay = distance * 2;
                        setTimeout(() => {
                            drops[i] = 1;
                        }, delay * 20);
                    }
                }
            }
        });

        
    </script>
</body>
</html>